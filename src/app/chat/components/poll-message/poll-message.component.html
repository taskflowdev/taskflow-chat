<!-- Loading state -->
<div class="poll-container poll-loading-initial" *ngIf="pollState.isLoading && !pollState.pollResults">
  <div class="loading-spinner"></div>
  <span>Loading poll...</span>
</div>

<!-- Error state -->
<div class="card poll-container poll-error-initial"
  *ngIf="!pollState.error && !pollState.pollResults && !pollState.isLoading">
  <div class="error-content">
    <i class="bi bi-exclamation-circle"></i>
    <span>{{ pollState.error || 'There was an error loading the poll. Please try again later.' }}</span>
  </div>
</div>

<!-- Content state -->
<div class="poll-container" *ngIf="pollState.pollResults && !pollState.isLoading && !pollState.error">
  <!-- Poll question header -->
  <div class="poll-header">
    <!-- Header top section: question and spinner -->
    <div class="poll-header-top">
      <i class="bi bi-bar-chart poll-icon"></i>
      <div class="poll-question-container">
        <h3 class="poll-question">{{ pollState.pollResults.question }}</h3>
        <span class="poll-type-text">{{ pollState.pollResults.allowMultipleAnswers ? 'Choose one or more answers' :
          'Choose one answer' }}</span>
      </div>
      <div class="poll-header-spinner" *ngIf="pollState.isUpdating">
        <div class="updating-spinner"></div>
      </div>
    </div>
  </div>

  <!-- Poll options -->
  <div class="poll-options">
    <app-poll-option *ngFor="let option of optionsData; trackBy: trackByOptionId" [option]="option"
      [isSelected]="isOptionSelected(option.id)"
      [allowMultipleAnswers]="pollState.pollResults.allowMultipleAnswers ?? false"
      [disabled]="pollState.isLoading || pollState.isUpdating" (optionSelected)="onOptionSelected($event)">
    </app-poll-option>
  </div>

  <!-- Poll footer with statistics -->
  <app-poll-footer [totalVotes]="pollState.pollResults.totalVotes ?? 0"
    [totalVoters]="pollState.pollResults.totalVoters ?? 0" [groupMemberCount]="groupMemberCount"
    [votingProgressPercentage]="votingProgressPercentage"
    [allowMultipleAnswers]="pollState.pollResults.allowMultipleAnswers ?? false" (viewVotes)="onViewVotes()">
  </app-poll-footer>
</div>

<!-- Poll Votes Viewer Off-Canvas -->
<app-poll-votes-viewer [pollResults]="pollState.pollResults" [isOpen]="showVotesViewer" (close)="onCloseVotesViewer()">
</app-poll-votes-viewer>
