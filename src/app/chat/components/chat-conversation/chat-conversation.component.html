<div class="chat-conversation" *ngIf="conversation || loading; else noConversationSelected">
  <!-- Conversation Header -->
  <div class="conversation-header" *ngIf="conversation && !loading">
    <div class="conversation-info">
      <h4 class="conversation-title">{{ conversation.groupName }}</h4>
      <p class="conversation-subtitle" *ngIf="conversation.memberCount">
        {{ conversation.memberCount }} member{{ conversation.memberCount !== 1 ? 's' : '' }}
      </p>
    </div>

    <div class="conversation-actions">
      <button class="btn action-btn" title="More options">
        <i class="bi bi-three-dots-vertical"></i>
      </button>
    </div>
  </div>

  <!-- Header Skeleton -->
  <div class="conversation-header" *ngIf="loading">
    <div class="conversation-info">
      <app-skeleton-loader type="text" width="150px" height="1.2rem" style="margin-bottom: 0.25rem;"></app-skeleton-loader>
      <app-skeleton-loader type="text" width="80px" height="0.875rem"></app-skeleton-loader>
    </div>
    <div class="conversation-actions">
      <app-skeleton-loader type="circle" width="32px" height="32px"></app-skeleton-loader>
    </div>
  </div>

  <!-- Messages Container -->
  <div class="messages-container" #messagesContainer>
    <!-- Loading Messages -->
    <div class="messages-list" *ngIf="loading">
      <app-skeleton-loader 
        *ngFor="let item of [1,2,3,4,5,6]"
        type="message">
      </app-skeleton-loader>
    </div>

    <!-- Loaded Messages -->
    <div class="messages-list" *ngIf="conversation && !loading">
      <app-chat-message *ngFor="let message of conversation.messages; trackBy: trackByMessageId" [message]="message">
      </app-chat-message>
    </div>
  </div>

  <!-- Message Input -->
  <div class="message-input-container" *ngIf="!loading">
    <div class="input-wrapper">
      <textarea [(ngModel)]="newMessage" (keydown)="onKeyDown($event)" placeholder="Type a message..."
        class="message-input" rows="1">
      </textarea>
      <button class="btn send-btn" (click)="onSendMessage()" [disabled]="!newMessage.trim()" title="Send message">
        <i class="bi bi-send-fill"></i>
      </button>
    </div>
  </div>
</div>

<ng-template #noConversationSelected>
  <div class="no-conversation">
    <div class="placeholder-content">
      <i class="bi bi-chat-quote placeholder-icon"></i>
      <h3 class="placeholder-title">No Chat Selected</h3>
      <p class="placeholder-subtitle">Pick a chat to continue</p>
      <p class="placeholder-footer">
        <i class="bi bi-lock"></i> Messages are end-to-end encrypted
      </p>
    </div>
  </div>
</ng-template>